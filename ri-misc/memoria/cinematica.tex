\datos{color}{}{}

\section{Estudio cinemático}
El fabricante proporciona los parámetros clásicos y modificados de Denavit-Hartenberg en el manual del usuario. En las 
siguientes secciones se van a estudiar dichos parámetros.

\subsection{Cinemática directa}
\subsubsection{Parámetros de Denavit-Hartenberg} \label{classDH}
En la figura \ref{fig:dh} se presentan los parámetros clásicos de Denavit-Hartenberg \cite{barrientos2007fundamentos} proporcionados por el fabricante, con 
\[
a_2 = \sqrt{284.5^2 + 53.5^2} = 289.48866
\]
\[
T_{2,\text{offset}} = -\arctan\left(\frac{284.5}{53.5}\right) = -1.3849179 \; (-79.34995^\circ);\;
T_{3,\text{offset}} = -T_{2,\text{offset}}.
\]

\begin{figure}[htb]
    \centering
    \includegraphics[scale=0.45]{Images/cinematica/dh.png}
    \caption{Parámetros clásicos Denavit-Hartenberg. Fuente: \cite{ufactory_xarm_manual}.}
    \label{fig:dh}
\end{figure}

\newpage
Para alcanzar los sitemas $2$ y $3$ se introduce un \textit{offset} dado que en la imagen la tercera articulación no están 
representada en el cero, por lo que el \textit{offset} es el ángulo de compensación de la articulación desde la posición
matemática cero hasta la posición mecánica cero que se muestra en la imagen. Esto se debe a que si se colocase en el cero, 
en la imagen quedaría detrás de otros eslabones y no se visualizaría. En otras palabras, el \textit{offset} angular corrige la
orientación sin necesidad de modificar el ángulo $\theta$ de la articulación y se suma directamente a $\theta_i$.\\

Además, a partir del análisis de la figura \ref{fig:dh} se observa la particularidad en la ubicación del origen de algunos sistemas,
como $3$ y $4$. Esta elección, aunque poco convencional, facilita el cálculo de los parámetros al estar directamente fundamentada en las dimensiones 
geométricas del robot. De este modo, el parámetro $d_4$ coincide con la distancia medida que aparece en la imagen de los 
parámetros de tamaño. Este hecho se repite para el resto de de parámetros longitudinales $d_1$, $a_3$, $a_5$, $d_6$. \\

La secuencia de transformaciones \cite{corke1996} y la matriz de transformación homogénea \cite{barrientos2007fundamentos}
asociada a dichas transformaciones se presentan en las ecuaciones \ref{eq:dh-seq} y \ref{eq:dh-a}:

\begin{equation}
{^{i-1}A_{i}} = 
\textbf{R}_Z(\theta^*_i = \theta_i + \text{\textit{offset}$_i$})\,
\textbf{T}_Z(d_i)\,
\textbf{T}_X(a_{i})\,
\textbf{R}_X(\alpha_{i})
\label{eq:dh-seq}
\end{equation}

\begin{equation}
{}^{i-1}\mathbf{A}_i =
\begin{bmatrix}
\cos\theta^*_i                  & -\sin\theta^*_i \cos\alpha_i     &  \sin\theta^*_i \sin\alpha_i     & a_i \cos\theta^*_i          \\
\sin\theta^*_i                  &  \cos\theta_i \cos\alpha_i     & -\cos\theta^*_i \sin\alpha_i     & a_i \sin\theta^*_i          \\
0                             &  \sin\alpha_i                  &  \cos\alpha_i                  & d_i                       \\
0                             &  0                             &  0                             & 1
\end{bmatrix}
\label{eq:dh-a}
\end{equation} \\

Se calculan a continuación las matrices de transformación del robot \textit{UFactory xArm 6} utilizando
los parámetros clásicos de Denavit-Hartenberg:
\[
A_1 =
\begin{bmatrix}
C(q_1) & 0 & -S(q_1) & 0 \\
S(q_1) & 0 & C(q_1) & 0 \\
0 & -1 & 0 & 267 \\
0 & 0 & 0 & 1
\end{bmatrix}
\]

\[
A_2 =
\begin{bmatrix}
C(q_2+\text{offset}_2) & -S(q_2+\text{offset}_2) & 0 & a_2\,C(q_2+\text{offset}_2) \\
S(q_2+\text{offset}_2) & C(q_2+\text{offset}_2) & 0 & a_2\,S(q_2+\text{offset}_2) \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_2=289.48866
\]

\[
A_3 =
\begin{bmatrix}
C(q_3+\text{offset}_3) & 0 & -S(q_3+\text{offset}_3) & a_3\,C(q_3+\text{offset}_3) \\
S(q_3+\text{offset}_3) & 0 & C(q_3+\text{offset}_3) & a_3\,S(q_3+\text{offset}_3) \\
0 & -1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_3=77.5
\]

\[
A_4 =
\begin{bmatrix}
C(q_4) & 0 & S(q_4) & 0 \\
S(q_4) & 0 & -C(q_4) & 0 \\
0 & 1 & 0 & 342.5 \\
0 & 0 & 0 & 1
\end{bmatrix}
,\;
A_5 =
\begin{bmatrix}
C(q_5) & 0 & -S(q_5) & a_5\,C(q_5) \\
S(q_5) & 0 & C(q_5) & a_5\,S(q_5) \\
0 & -1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_5=76
\]

\[
A_6 =
\begin{bmatrix}
C(q_6) & -S(q_6) & 0 & 0 \\
S(q_6) & C(q_6) & 0 & 0 \\
0 & 0 & 1 & 97 \\
0 & 0 & 0 & 1
\end{bmatrix}
\]

Siendo la transformación total:
\[
T_0^{\,6}(q) = A_1(q_1)\;A_2(q_2+\text{offset}_2)\;A_3(q_3+\text{offset}_3)\;A_4(q_4)\;A_5(q_5)\;A_6(q_6)
\] \\

Podemos calcular y comprobar el resultado en \textit{Matlab} \cite{matlabonline2025} y la \textit{toolbox} de
Peter Corke \cite{corke_robotics_toolbox}:
\begin{listing}[htb]
    \centering
    \lstinputlisting[]{Matlab/dh.m}
    \caption{Código Matlab para la cinemática directa con parámetros DH clásicos.}
    \label{lst:dh}
\end{listing}
\begin{listing}[htb]
    \centering
    \lstinputlisting[]{Matlab/dh_salida.txt}
    \caption{Salida numérica de la cinemática directa DH clásica.}
    \label{lst:dh_salida}
\end{listing}

\clearpage
\subsubsection{Parámetros modificados de Denavit-Hartenberg}
El método clásico de Denavit-Hartenberg, propuesto en 1955, presentaba ciertas limitaciones en la colocación de los sistemas
de referencia, especialmente cuando dos ejes consecutivos eran paralelos. En estos casos podían aparecer ambigüedades en la
definición de los parámetros y problemas numéricos en las matrices de transformación. \\

Para superar estas dificultades John J. Craig introdujo el método modificado de Denavit-Hartenberg o convención de Craig
\cite{craig1986, paul1986}, que redefine las transformaciones con respecto al sistema $i$ en lugar de hacerlo respecto al sistema $i-1$. El método modificado mantiene los
cuatro parámetros $\theta_i, d_i, a_i, \alpha_i$, pero cambia la referencia de los ejes lo que hace más intuitiva la
asignación de marcos. El nuevo procedimiento para asignar los sistemas de referencia se resume en los siguientes pasos:
\begin{enumerate}
    \item Identificar los ejes de las articulaciones.
    \item Considerar dos ejes consecutivos ($i$ y $i+1$) e identificar la perpendicular común entre ellos, o bien el punto de intersección.
          En dicho punto de intersección, o en el punto donde la perpendicular común corta al eje $i$, se asigna el origen del sistema de enlace.
    \item Asignar el eje $Z_i$ apuntando a lo largo del eje de la articulación $i$.
    \item Asignar el eje $X_i$ apuntando a lo largo de la perpendicular común. Si los ejes se intersectan, se asigna $X_i$ como normal al plano que contiene ambos ejes.
    \item Asignar el eje $Y_i$ de manera que se complete un sistema de coordenadas con la regla de la mano derecha (sistema dextrógiro).
    \item Asignar el sistema $\{0\}$ coincidiendo con $\{1\}$ cuando la primera variable articular sea cero. Para el sistema $\{N\}$, elegir libremente la posición del origen y la dirección de $X_N$, procurando que el mayor número posible de parámetros de enlace se anulen.
\end{enumerate}

Consecuentemente, la secuencia de transformaciones \cite{corke1996} y la matriz de transformación homogénea
asociada a dichas transformaciones se presentan en las ecuaciones \ref{eq:dh_mod-seq} y \ref{eq:dh_mod-a}:
\begin{equation}
{^{i-1}\bar{A}_{i}} = 
\textbf{R}_X(\alpha_{i-1})\,
\textbf{T}_X(a_{i-1})\,
\textbf{R}_Z(\theta_i)
\textbf{T}_Z(d_i)\,
\label{eq:dh_mod-seq}
\end{equation}

\begin{equation}
{}^{i-1}\mathbf{A}_i = 
\begin{bmatrix}
\cos\theta_i                  & -\sin\theta_i &  0 & a_{i-1}      \\
\sin\theta_i \cos\alpha_{i-1}                  &  \cos\theta_i \cos\alpha_{i-1} & -\sin\alpha_{i-1} & -d_i \sin\alpha_{i-1}      \\
\sin\theta_i \sin\alpha_{i-1}              &  \sin\alpha_{i-1} \cos\theta_i              &  \cos\alpha_{i-1}              & d_i \cos\alpha_{i-1}                      \\
0                             &  0                             &  0                             & 1
\end{bmatrix}
\label{eq:dh_mod-a}
\end{equation} \\

Esta convención ofrece ventajas como la asignación única y consistente de marcos a cada eslabón porque simplifica la 
implementación computacional y la integración con modelos de diseño asistido por computadora (CAD), donde se prefieren
coordenadas locales de eslabón \cite{corke1996}. Además, facilita los cálculos recursivos de cinemática, Jacobianos
y dinámica, evitando las ambigüedades de colocación presentes en el método estándar y es la notación más clara
y transparente para el análisis mecánico. \\

\newpage
En la figura \ref{fig:dh_mod} se presentan los parámetros modificados de Denavit-Hartenberg proporcionados por el fabricante, con 
\[
a_2 = \sqrt{284.5^2 + 53.5^2} = 289.48866
\]
\[
T_{2,\text{offset}} = -\arctan\left(\frac{284.5}{53.5}\right) = -1.3849179 \; (-79.34995^\circ)
\]
\[
T_{3,\text{offset}} = -T_{2,\text{offset}} = 1.3849179 \; (79.34995^\circ).
\]
\begin{figure}[htb]
    \centering
    \includegraphics[scale=0.45]{Images/cinematica/dh_mod.png}
    \caption{Parámetros modificados Denavit-Hartenberg. Fuente: \cite{ufactory_xarm_manual}.}
    \label{fig:dh_mod}
\end{figure}

Al igual que con los parámetros clásicos, sección \ref{classDH}, para alcanzar los sitemas $2$ y $3$ se introduce un \textit{offset} dado que en la imagen la tercera articulación no están 
representada en el cero y se observa la particularidad en la ubicación del origen de algunos sistemas,
como $3$ y $4$, que facilita el cálculo de los parámetros al estar directamente fundamentada en las dimensiones 
geométricas del robot. \\

Se calculan a continuación las matrices de transformación del robot \textit{UFactory xArm 6} utilizando
los parámetros modificados de Denavit-Hartenberg:

\[
A_1 =
\begin{bmatrix}
C(q_1) & -S(q_1) & 0 & 0 \\
S(q_1) & C(q_1) & 0 & 0 \\
0 & 0 & 1 & d_1 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad d_1 = 267
\]

\[
A_2 =
\begin{bmatrix}
C(q_2+T2_{\text{offset}}) & -S(q_2+T2_{\text{offset}}) & 0 & 0 \\
0 & 0 & 1 & 0 \\
-\,S(q_2+T2_{\text{offset}}) & -\,C(q_2+T2_{\text{offset}}) & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\]

\[
A_3 =
\begin{bmatrix}
C(q_3+T3_{\text{offset}}) & -S(q_3+T3_{\text{offset}}) & 0 & a_2 \\
S(q_3+T3_{\text{offset}}) & C(q_3+T3_{\text{offset}}) & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_2 = 289.48866
\]

\[
A_4 =
\begin{bmatrix}
C(q_4) & -S(q_4) & 0 & a_3 \\
0 & 0 & 1 & d_4 \\
-\,S(q_4) & -\,C(q_4) & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_3 = 77.5,\; d_4 = 342.5
\]

\[
A_5 =
\begin{bmatrix}
C(q_5) & 0 & S(q_5) & 0 \\
S(q_5) & 0 & -C(q_5) & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\]

\[
A_6 =
\begin{bmatrix}
C(q_6) & -S(q_6) & 0 & a_5 \\
0 & 0 & 1 & d_6 \\
-\,S(q_6) & -\,C(q_6) & 0 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\quad a_5 = 76,\; d_6 = 97
\] \\

Siendo la transformación total:
\[
T_0^{\,6}(q) = A_1(q_1)\;A_2(q_2+T2_{\text{offset}})\;A_3(q_3+T3_{\text{offset}})\;A_4(q_4)\;A_5(q_5)\;A_6(q_6)
\]\\

Podemos calcular y comprobar el resultado en \textit{Matlab} \cite{matlabonline2025} y la \textit{toolbox} de
Peter Corke \cite{corke_robotics_toolbox}:
\begin{listing}[htb]
    \centering
    \lstinputlisting[]{Matlab/dh_mod.m}
    \caption{Código Matlab para la cinemática directa con parámetros DH modificados.}
    \label{lst:dh_mod}
\end{listing}
\begin{listing}[htb]
    \centering
    \lstinputlisting[]{Matlab/dh_mod_salida.txt}
    \caption{Salida numérica de la cinemática directa DH modificada.}
    \label{lst:dh_mod_salida}
\end{listing}

\clearpage
\subsection{Cinemática inversa}
Tanto para los parámetros clásicos como para los modificados de Denavit-Hartenberg
las ecuaciones obtenidas a resolver son geométricamente iguales, y obtienen los mismos 
resultados, pero las ventajas de la convención modificada suelen facilitar su resolución.
Por ello, se estudia la cinematica inversa sobre los parámetros modificados. \\

Cuando la muñeca es esférica, es decir, los ejes de las articulaciones 4, 5 y 6 se cortan en 
único punto o $a_4 = a_5 = a_6 = 0, d_5 = d_6 = 0$, se puede aplicar el método de desacoplo cinemático
\cite{barrientos2007fundamentos}. Sin embargo, esta propiedad no se cumple en el robot
\textit{UFactory xArm6}, ya que la posición y orientación depende de todas las articulaciones.
Por tanto, no existe separación natural entre el brazo y la muñeca y la cinemática inversa 
se vuelve mucho más compleja porque no existe en forma cerrada. \\

Consecuentemente, este problema no puede resolverse analíticamente y tiene que ser resuelto 
con métodos numéricos iterativos como el inverso, pseudo-inverso y transpuesto del Jacobiano, 
Newton–Raphson o Levenberg–Marquardt, entre otros, utilizando las 12 ecuaciones de la matriz de 
transformación $T_0^{\,6}$. Estos métodos aproximan la solución
mediante iteraciones sucesivas, minimizando el error entre la posición y orientación deseada y 
la alcanzada alcanzada por el robot.\\

El repositorio oficial del fabricante \cite{xarm_ros2} utiliza \textit{MoveIt 2} \cite{moveit2}, que 
resuelve la cinemática directa mediante Jacobiano pseudo-inverso y métodos iterativos de tipo 
Newton–Raphson.

De la matriz de transformación obtenida en el código \ref{lst:dh_mod},
$T_0^{\,6} = \begin{bmatrix}
r_{11} & r_{12} & r_{13} & p_x \\
r_{21} & r_{22} & r_{23} & p_y \\
r_{31} & r_{32} & r_{33} & p_z \\
0      & 0      & 0      & 1
\end{bmatrix}
$, se obtienen las 
siguientes ecuaciones de posición y orientación:

\[
\begin{aligned}
p_x &= 
\cos(q_1)\cos(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 76\cos q_4 \cos q_5 - 97\cos q_4 \sin q_5 + \frac{155}{2} \right) \\
&\quad + a_2 \cos(q_1)\cos(T2_{\text{offset}} + q_2) \\
&\quad - \cos(q_1)\sin(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 97\cos q_5 + 76\sin q_5 + \frac{685}{2} \right) \\
&\quad + \sin(q_1)\sin(q_4)\left( 76\cos q_5 - 97\sin q_5 \right),
\end{aligned}
\] \\

\[
\begin{aligned}
p_y &= 
\sin(q_1)\cos(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 76\cos q_4 \cos q_5 - 97\cos q_4 \sin q_5 + \frac{155}{2} \right) \\
&\quad + a_2 \sin(q_1)\cos(T2_{\text{offset}} + q_2) \\
&\quad - \sin(q_1)\sin(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 97\cos q_5 + 76\sin q_5 + \frac{685}{2} \right) \\
&\quad - \cos(q_1)\sin(q_4)\left( 76\cos q_5 - 97\sin q_5 \right),
\end{aligned}
\] \\


\[
\begin{aligned}
p_z &= 
267 - a_2 \sin(T2_{\text{offset}} + q_2) \\
&\quad - \cos(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 97\cos q_5 + 76\sin q_5 + \frac{685}{2} \right) \\
&\quad - \sin(T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3)
\left( 76\cos q_4 \cos q_5 - 97\cos q_4 \sin q_5 + \frac{155}{2} \right).
\end{aligned}
\] \\

Sea $\phi = T2_{\text{offset}} + T3_{\text{offset}} + q_2 + q_3$, 
de modo que las expresiones de la matriz de rotación se simplifican.

\[
\begin{aligned}
& r_{11} =
\sin q_1 \left(\cos q_4 \sin q_6 + \cos q_5 \cos q_6 \sin q_4\right)
- \cos q_1 \cos\phi \left(\sin q_4 \sin q_6 - \cos q_4 \cos q_5 \cos q_6\right) \\
&\quad - \cos q_1 \sin\phi \,\cos q_6 \sin q_5
\end{aligned}
\]

\[
\begin{aligned}
& r_{12} = 
\sin q_1 \left(\cos q_4 \cos q_6 - \cos q_5 \sin q_4 \sin q_6\right) 
- \cos q_1 \cos\phi \left(\cos q_6 \sin q_4 + \cos q_4 \cos q_5 \sin q_6\right) \\
&\quad + \cos q_1 \sin\phi \,\sin q_5 \sin q_6 \end{aligned} \]

\[
\begin{aligned}
r_{13} = 
-\sin q_1 \sin q_4 \sin q_5
- \cos q_1 \sin\phi \,\cos q_5
- \cos q_1 \cos\phi \,\cos q_4 \sin q_5
\end{aligned} \]

\[
\begin{aligned}
& r_{21} =
-\cos q_1 \left(\cos q_4 \sin q_6 + \cos q_5 \cos q_6 \sin q_4\right)
- \sin q_1 \cos\phi \left(\sin q_4 \sin q_6 - \cos q_4 \cos q_5 \cos q_6\right) \\
&\quad - \sin q_1 \sin\phi \,\cos q_6 \sin q_5 \end{aligned}\]

\[
\begin{aligned}
& r_{22} =
\sin q_1 \sin\phi \,\sin q_5 \sin q_6
- \sin q_1 \cos\phi \left(\cos q_6 \sin q_4 + \cos q_4 \cos q_5 \sin q_6\right) \\
&\quad - \cos q_1 \left(\cos q_4 \cos q_6 - \cos q_5 \sin q_4 \sin q_6\right) \end{aligned}\]

\[ \begin{aligned}
r_{23} =
\cos q_1 \sin q_4 \sin q_5
- \sin q_1 \sin\phi \,\cos q_5
- \sin q_1 \cos\phi \,\cos q_4 \sin q_5
\end{aligned}
\]

\[
\begin{aligned}
r_{31} &=
\sin\phi \left(\sin q_4 \sin q_6 - \cos q_4 \cos q_5 \cos q_6\right)
- \cos\phi \,\cos q_6 \sin q_5 \end{aligned} \]

\[ \begin{aligned}
r_{32} &=
\sin\phi \left(\cos q_6 \sin q_4 + \cos q_4 \cos q_5 \sin q_6\right)
+ \cos\phi \,\sin q_5 \sin q_6 \end{aligned} \]

\[ \begin{aligned}
r_{33} &=
\sin\phi \,\cos q_4 \sin q_5
- \cos\phi \,\cos q_5
\end{aligned}
\] \\


% https://www.youtube.com/watch?v=mxf5H84L0Wo

Estas ecuaciones se han obtenido con la ayuda de \textit{Matlab} \cite{matlabonline2025} y la
\textit{toolbox} de Peter Corke \cite{corke_robotics_toolbox}:
\begin{listing}[htb]
    \centering
    \lstinputlisting[]{Matlab/ik.m}
    \caption{Código Matlab para obtener las ecuaciones de posición y orientación con parámetros DH modificados.}
    \label{lst:ik}
\end{listing}

\clearpage
\subsection{Pseudoinversa del Jacobiano y Newton--Raphson}
Como se expone en \cite{barrientos2007fundamentos}, la relación
entre las velocidades articulares y la velocidad del efector final viene dada por

\[
\dot{x} = J(q)\,\dot{q},
\]

donde $J(q)$ es el Jacobiano geométrico. Para invertir esta relación y obtener un
incremento articular a partir del error cartesiano, se emplea la pseudoinversa de
Moore--Penrose:

\[
\dot{q} = J^{\dagger}(q)\,\dot{x},
\qquad
J^{\dagger} = (J^\top J)^{-1} J^\top,
\]

si el Jacobiano es de rango completo. Este enfoque permite calcular un incremento articular
que minimiza en norma cuadrática el error cartesiano, incluso en configuraciones próximas a
singularidades o en robots redundantes.

Aplicando este principio a la cinemática inversa, se plantea el problema como la resolución
iterativa de

\[
e = x_d - f(q),
\]

donde $f(q)$ es la cinemática directa. Linealizando mediante el Jacobiano se obtiene el
método de Newton--Raphson:

\[
q_{k+1} = q_k + J^{\dagger}(q_k)\, (x_d - f(q_k)).
\]

Este procedimiento converge de forma eficiente cuando la estimación inicial es adecuada y
constituye uno de los métodos numéricos más utilizados en robótica para resolver la
cinemática inversa de manipuladores sin muñeca esférica.







